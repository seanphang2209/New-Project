# Cloudflare Pages Setup Instructions

## The Solution: Using @cloudflare/next-on-pages

This project uses `@cloudflare/next-on-pages` to properly deploy Next.js to Cloudflare Pages.

### Step 1: Update Cloudflare Pages Build Settings

1. Go to **Cloudflare Dashboard** → **Pages** → Your Project
2. Click **Settings** → **Builds & deployments**
3. Update these settings:

   **Build command:**
   ```
   npm run build
   ```
   (or `bun run build` if using bun)
   
   This automatically runs:
   - `next build` - Builds the Next.js app
   - `npx @cloudflare/next-on-pages` - Converts output for Cloudflare Pages

   **Build output directory:**
   ```
   .vercel/output/static
   ```
   (Generated by @cloudflare/next-on-pages)

   **Root directory:**
   ```
   /
   ```
   (Leave blank or use `/`)

   **Node version:**
   ```
   18.x
   ```
   (or 20.x)

### Step 2: Save and Redeploy

1. Click **Save** on the build settings
2. Go to **Deployments** tab
3. Click **Retry deployment** on the failed deployment, OR
4. Push a new commit to trigger automatic deployment

## How It Works

- `npm run build` runs `next build && npx @cloudflare/next-on-pages`
- This generates `.vercel/output/static` with static assets
- Functions are auto-detected from `.vercel/output/functions`
- Cloudflare Pages automatically deploys the static assets

## Verification

After updating settings, the build logs should show:
1. ✅ `Installing project dependencies`
2. ✅ `Executing user deploy command: npm run build`
3. ✅ `Creating an optimized production build...`
4. ✅ `Running @cloudflare/next-on-pages...`
5. ✅ `Output written to .vercel/output/static`
6. ✅ Deployment succeeds

## Manual Deployment (Optional)

If you need to deploy manually:

```bash
npm run build
npm run deploy:pages
```

Or using wrangler directly:
```bash
wrangler pages deploy .vercel/output/static --project-name=carbonatlas
```

